[gd_scene load_steps=19 format=2]

[ext_resource path="res://Game Objects/Player.tscn" type="PackedScene" id=1]
[ext_resource path="res://Game Objects/Room.tscn" type="PackedScene" id=2]
[ext_resource path="res://Scenes/Rooms/Hallway.tscn" type="PackedScene" id=3]
[ext_resource path="res://Game Objects/TV.tscn" type="PackedScene" id=4]
[ext_resource path="res://Scripts/Objects/TV.gd" type="Script" id=5]
[ext_resource path="res://Scripts/Objects/ActivateConclusionTrigger.gd" type="Script" id=6]

[sub_resource type="CylinderMesh" id=1]
top_radius = 0.2
bottom_radius = 0.35
height = 0.1

[sub_resource type="SpatialMaterial" id=2]
flags_unshaded = true
albedo_color = Color( 0.431373, 0.27451, 0.27451, 1 )

[sub_resource type="SpatialMaterial" id=3]
flags_transparent = true
flags_unshaded = true
albedo_color = Color( 0.431373, 0.27451, 0.27451, 0.0156863 )

[sub_resource type="CylinderMesh" id=4]
material = SubResource( 3 )
top_radius = 0.9
bottom_radius = 0.1
height = 1.8

[sub_resource type="CylinderMesh" id=5]
top_radius = 0.2
bottom_radius = 0.35
height = 0.1

[sub_resource type="CylinderMesh" id=6]
top_radius = 0.2
bottom_radius = 0.35
height = 0.1

[sub_resource type="GDScript" id=7]
script/source = "extends Area

signal timeout
var time = 0

enum Rooms { STATE_INACTIVE, STATE_MOM, STATE_SISTER, STATE_MY_ROOM }
export(Rooms) var CurrentRoom

onready var _Player = $\"../Player\"

func _physics_process(delta: float) -> void:

	print(GlobalUi.CurrentRoomState)
	if overlaps_body(_Player):
		time = 0
		match CurrentRoom:
			GlobalUi.Rooms.STATE_INACTIVE:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_INACTIVE
				pass
			GlobalUi.Rooms.STATE_MOM:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_MOM
				pass
			GlobalUi.Rooms.STATE_SISTER:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_SISTER
				pass
			GlobalUi.Rooms.STATE_MY_ROOM:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_MY_ROOM
				pass
		pass
	else:
		time += delta
		if time > 1.0:
			GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_INACTIVE	
			emit_signal(\"timeout\")
			time = 0
"

[sub_resource type="GDScript" id=8]
script/source = "extends Area

signal timeout
var time = 0

enum Rooms { STATE_INACTIVE, STATE_MOM, STATE_SISTER, STATE_MY_ROOM }
export(Rooms) var CurrentRoom

onready var _Player = $\"../Player\"

func _physics_process(delta: float) -> void:

	print(GlobalUi.CurrentRoomState)
	if overlaps_body(_Player):
		time = 0
		match CurrentRoom:
			GlobalUi.Rooms.STATE_INACTIVE:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_INACTIVE
				pass
			GlobalUi.Rooms.STATE_MOM:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_MOM
				pass
			GlobalUi.Rooms.STATE_SISTER:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_SISTER
				pass
			GlobalUi.Rooms.STATE_MY_ROOM:
				GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_MY_ROOM
				pass
		pass
	else:
		time += delta
		if time > 1.0:
			GlobalUi.CurrentRoomState = GlobalUi.Rooms.STATE_INACTIVE	
			emit_signal(\"timeout\")
			time = 0
"

[sub_resource type="GIProbeData" id=9]
bounds = AABB( -5.69686, -3.34807, -9.12558, 11.3937, 6.69614, 18.2512 )
cell_size = 0.142587
to_cell_xform = Transform( 7.01325, 0, 0, 0, 7.01325, 0, 0, 0, 7.01325, 39.9535, 23.4809, 64 )
dynamic_data = PoolIntArray( 0, 8, 128, 64, 128, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 8355711, 0 )
dynamic_range = 4
energy = 0.09
bias = 1.5
normal_bias = 0.0
propagation = 0.7

[sub_resource type="BakedLightmapData" id=10]
bounds = AABB( -10, -10, -10, 20, 20, 20 )
cell_space_transform = Transform( 0.4, 0, 0, 0, 0.4, 0, 0, 0, 0.4, 4, 4, 4 )
cell_subdiv = 4
octree = PoolByteArray( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 )

[sub_resource type="BoxShape" id=11]
extents = Vector3( 1.45861, 1, 0.29074 )

[sub_resource type="BoxShape" id=12]
extents = Vector3( 1, 0.818442, 0.2 )

[node name="World" type="Spatial"]

[node name="Hallway" parent="." instance=ExtResource( 3 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -11 )

[node name="Lighting" type="Spatial" parent="."]
__meta__ = {
"_edit_lock_": true
}

[node name="SpotLight" type="SpotLight" parent="Lighting"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 1.62714, -3.21061 )
light_color = Color( 0.431373, 0.27451, 0.27451, 1 )
light_energy = 7.53
light_indirect_energy = 0.0
light_specular = 0.15
shadow_enabled = true
spot_range = 3.5
spot_angle = 31.0

[node name="Light Mesh" type="MeshInstance" parent="Lighting/SpotLight"]
transform = Transform( 0.25, 0, 0, 0, 4.86768e-08, 0.25, 0, -0.25, 4.86768e-08, 0, 0, 0 )
mesh = SubResource( 1 )
material/0 = SubResource( 2 )

[node name="Light Ray" type="MeshInstance" parent="Lighting/SpotLight"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 0, -0.835044 )
mesh = SubResource( 4 )
material/0 = null

[node name="SpotLight2" type="SpotLight" parent="Lighting"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 1.62714, -7.21061 )
light_color = Color( 0.431373, 0.27451, 0.27451, 1 )
light_energy = 8.28
light_indirect_energy = 7.13
shadow_enabled = true
spot_range = 3.5
spot_angle = 30.0

[node name="Light Mesh2" type="MeshInstance" parent="Lighting/SpotLight2"]
transform = Transform( 0.25, 0, 0, 0, 4.86768e-08, 0.25, 0, -0.25, 4.86768e-08, 0, 0, 0 )
mesh = SubResource( 5 )
material/0 = SubResource( 2 )

[node name="Light Ray2" type="MeshInstance" parent="Lighting/SpotLight2"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, -0.160239, -0.835045 )
mesh = SubResource( 4 )
material/0 = null

[node name="SpotLight3" type="SpotLight" parent="Lighting"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 1.62714, -10.2106 )
light_color = Color( 0.431373, 0.27451, 0.27451, 1 )
light_energy = 8.28
light_indirect_energy = 7.13
shadow_enabled = true
spot_range = 3.5
spot_angle = 30.0

[node name="Light Mesh3" type="MeshInstance" parent="Lighting/SpotLight3"]
transform = Transform( 0.25, 0, 0, 0, 4.86768e-08, 0.25, 0, -0.25, 4.86768e-08, 0, 0, 0 )
mesh = SubResource( 6 )
material/0 = SubResource( 2 )

[node name="Light Ray3" type="MeshInstance" parent="Lighting/SpotLight3"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, -0.236351, -0.835045 )
mesh = SubResource( 4 )
material/0 = null

[node name="Player" parent="." instance=ExtResource( 1 )]

[node name="MomsRoom" parent="." instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.740195, 0.563332, -4.94543 )
script = SubResource( 7 )
CurrentRoom = 1

[node name="OmniLight" type="OmniLight" parent="MomsRoom"]
light_color = Color( 0.333333, 0.0901961, 0.0901961, 1 )
shadow_enabled = true
omni_range = 0.5

[node name="SisterRoom" parent="." instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.753339, 0.609157, -6.72684 )
script = SubResource( 8 )
CurrentRoom = 2

[node name="OmniLight" type="OmniLight" parent="SisterRoom"]
light_color = Color( 0.333333, 0.0901961, 0.0901961, 1 )
shadow_enabled = true
omni_range = 0.3

[node name="MyRoom" parent="." instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.838958, 0.562163, -9.03583 )
CurrentRoom = 3

[node name="GIProbe" type="GIProbe" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -5.86584 )
extents = Vector3( 5.69686, 3.34807, 9.12558 )
energy = 0.09
data = SubResource( 9 )
__meta__ = {
"_edit_lock_": true
}

[node name="BakedLightmap" type="BakedLightmap" parent="."]
bake_cell_size = 5.0
bake_quality = 2
bake_hdr = true
light_data = SubResource( 10 )
__meta__ = {
"_edit_lock_": true
}

[node name="TV" parent="." instance=ExtResource( 4 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.094, 0, -10.656 )

[node name="Screen" parent="TV" index="2"]
frame = 2

[node name="OmniLight" parent="TV/Screen" index="0"]
visible = false

[node name="TV Audio" parent="TV" index="4"]
volume_db = 0.0
pitch_scale = 0.9
autoplay = false
mix_target = 1

[node name="ActivateConclusionTrigger" type="Area" parent="TV"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.094, 1, 6.656 )
script = ExtResource( 6 )

[node name="CollisionShape" type="CollisionShape" parent="TV/ActivateConclusionTrigger"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0264727, 0.00699925, -6.31412 )
shape = SubResource( 11 )

[node name="ActivateTVTrigger" type="Area" parent="TV"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.094, 1, 6.656 )
script = ExtResource( 5 )

[node name="CollisionVolume" type="CollisionShape" parent="TV/ActivateTVTrigger"]
shape = SubResource( 12 )

[editable path="TV"]
